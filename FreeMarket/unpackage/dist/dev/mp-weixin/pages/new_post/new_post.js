"use strict";const e=require("../../common/vendor.js"),t=require("../../cfg.js");Array||e.resolveComponent("uni-file-picker")();const g=()=>"../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js";Math||g();const m=e.defineComponent({__name:"new_post",setup(u){const o=e.ref({post_id:"",post_by:getApp().globalData.login.userid,title:"",content:"",imgs:[],post_date:"",isDel:!1}),l=e.ref([]),n=e.ref("");e.onLoad(s=>{n.value=s.op,n.value==="modify"&&e.index.request({url:`${t.cfg.server}:${t.cfg.port}${t.cfg.api.prefix}${t.cfg.api.post.prefix}${t.cfg.api.post.read_post}`,method:"POST",data:{post_id:s.post_id,isEdit:!0},success(i){if(i.statusCode===200){o.value=i.data.data,l.value=JSON.parse(JSON.stringify(i.data.data.imgs));for(let a in l.value)l.value[a].url=t.cfg.server+":"+t.cfg.port+"/"+l.value[a].url}}})});function p(){const s=n.value==="modify"?{userid:getApp().globalData.login.userid,modify_form:o.value}:{userid:getApp().globalData.login.userid,post_data:{title:o.value.title,content:o.value.content,imgs:o.value.imgs}},i=t.cfg.server+":"+t.cfg.port+t.cfg.api.prefix+t.cfg.api.post.prefix;e.index.request({url:i+(n.value==="modify"?t.cfg.api.post.modify_post:t.cfg.api.post.create_post),method:"POST",data:s,success(a){if(console.log(a),a.statusCode===200){const c=n.value==="modify"?"帖子修改成功":"帖子创建成功";console.log(c),e.index.navigateBack(),e.index.showToast({icon:"success",title:c})}}})}function r(s){e.index.uploadFile({url:t.cfg.server+":"+t.cfg.port+t.cfg.api.prefix+t.cfg.api.files.prefix+t.cfg.api.files.upload_file,filePath:s.tempFilePaths[0],name:"file",success(i){if(i.statusCode===200){const a=JSON.parse(i.data)[0].path.split("\\"),c="files\\\\".concat(a[1]);o.value.imgs.push({name:JSON.parse(i.data)[0].filename,url:c,extname:s.tempFiles[0].extname})}}})}function f(s){o.value.imgs=o.value.imgs.filter(i=>i.name!==s.tempFile.name),l.value=l.value.filter(i=>i.name!==s.tempFile.name)}function d(){p()}return(s,i)=>({a:o.value.title,b:e.o(a=>o.value.title=a.detail.value),c:o.value.content,d:e.o(a=>o.value.content=a.detail.value),e:e.o(d),f:e.o(r),g:e.o(f),h:e.o(a=>l.value=a),i:e.p({fileMediatype:"image",limit:"9",title:"配图",modelValue:l.value})})}}),_=e._export_sfc(m,[["__file","F:/HBuilderProjects/FreeMarket/pages/new_post/new_post.vue"]]);wx.createPage(_);
