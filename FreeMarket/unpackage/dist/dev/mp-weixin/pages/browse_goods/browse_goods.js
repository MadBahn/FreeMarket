"use strict";const e=require("../../common/vendor.js"),n=require("../../cfg.js");if(!Array){const u=e.resolveComponent("uni-card"),o=e.resolveComponent("uni-section"),s=e.resolveComponent("uni-icons");(u+o+s)()}const b=()=>"../../uni_modules/uni-card/components/uni-card/uni-card.js",y=()=>"../../uni_modules/uni-section/components/uni-section/uni-section.js",h=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js";Math||(T+j+C+b+w+$+y+h)();const w=()=>"../../components/comment_input/comment_input.js",$=()=>"../../components/comment_display/comment_display.js",T=()=>"../../components/content_loading/content_loading.js",j=()=>"../../components/content_error/content_error.js",C=()=>"../../components/common_report/common_report.js",S=e.defineComponent({__name:"browse_goods",setup(u){const o=e.ref({}),s=e.ref({}),i=e.ref(!0),a=e.ref(!1);e.onLoad(t=>{e.index.showNavigationBarLoading(),s.value.id=t.id,s.value.userid=t.userid,d(s.value)}),e.onError(t=>{console.log(t),a.value=!0});function d(t){e.index.request({url:`${n.cfg.server}:${n.cfg.port}${n.cfg.api.prefix}${n.cfg.api.goods.prefix}${n.cfg.api.goods.goods_info}`,method:"POST",data:{goods_id:t.id,userid:t.userid},success(r){console.log(r),r.statusCode===200?o.value=r.data.data:a.value=!0,console.log(o.value)},fail(){a.value=!0,e.index.setNavigationBarTitle({title:"出错了"})},complete(){i.value=!1,e.index.hideNavigationBarLoading()}})}function g(t){e.index.request({url:n.cfg.server+":"+n.cfg.port+n.cfg.api.prefix+n.cfg.api.user.prefix+n.cfg.api.user.create_comment,method:"POST",data:{comment_form:{content:t,comment_to:o.value.goods_id,comment_by:getApp().globalData.login.userid}},success(r){if(console.log(r),r.statusCode===200){const c=r.data;c.comment_by=getApp().globalData.login,o.value.comments.push(c)}}})}function p(){e.index.createSelectorQuery().select("#comment").boundingClientRect(t=>{e.index.createSelectorQuery().select(".main_content").boundingClientRect(r=>{e.index.pageScrollTo({duration:100,scrollTop:t.top-r.top})}).exec()}).exec()}function m(){e.index.request({url:n.cfg.server+":"+n.cfg.port+n.cfg.api.prefix+n.cfg.api.user.prefix+n.cfg.api.user.favorite,method:"POST",data:{favorite_form:{userid:getApp().globalData.login.userid,refer_to:o.value.goods_id}},success(t){console.log(t),t.statusCode===200&&(e.index.showToast({icon:"success",title:t.data.msg}),o.value.isFavorite=!o.value.isFavorite)}})}function f(){e.index.request({url:`${n.cfg.server}:${n.cfg.port}${n.cfg.api.prefix}${n.cfg.api.goods.prefix}${n.cfg.api.goods.create_deal}`,method:"POST",data:{exchange_form:{buyer:getApp().globalData.login.userid,seller:o.value.owner.userid,goods:o.value.goods_id,price:o.value.price}},success(t){console.log(t),e.index.showToast({icon:t.statusCode===200?"success":"error",title:t.data.msg})}})}function _(){console.log("reach call"),l(o.value.goods_id)}function l(t){console.log(t),e.index.navigateTo({url:"/pages/report/report?refer_to="+t+"&report_by="+getApp().globalData.login.userid})}function v(t){e.index.navigateTo({url:`/pages/info/info?id=${t}`})}return(t,r)=>e.e({a:i.value},i.value?{}:{},{b:a.value},a.value?{}:{},{c:!a.value},a.value?{}:e.e({d:"url("+(o.value.owner.headImg!==""?e.unref(n.cfg).server+":"+e.unref(n.cfg).port+"/"+o.value.owner.headImg:e.unref(n.cfg).default_avatar)+")",e:e.t(o.value.owner.username?o.value.owner.username:o.value.owner),f:e.t(new Date(o.value.post_date).toLocaleString()),g:e.o(c=>v(o.value.owner.userid)),h:e.t(o.value.price),i:e.t(o.value.status),j:e.t(o.value.desc),k:e.f(o.value.imgs,(c,x,P)=>({a:x,b:e.unref(n.cfg).server+":"+e.unref(n.cfg).port+"/"+c.url})),l:e.o(_),m:e.p({isFull:"true"}),n:e.o(g),o:e.o(l),p:e.p({_data:o.value.comments}),q:e.p({id:"comment",titleFontSize:"20px",title:"评论",type:"line"}),r:!o.value.error},o.value.error?{}:{s:e.o(p),t:e.p({color:"#1296db",size:"40",type:"chat"}),v:e.o(m),w:e.p({color:"#1296db",size:"40",type:o.value.isFavorite?"star-filled":"star"}),x:e.o(f)}))}}),q=e._export_sfc(S,[["__scopeId","data-v-fdc5c65b"],["__file","F:/HBuilderProjects/FreeMarket/pages/browse_goods/browse_goods.vue"]]);wx.createPage(q);
