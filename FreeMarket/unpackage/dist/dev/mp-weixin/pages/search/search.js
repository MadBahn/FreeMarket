"use strict";const e=require("../../common/vendor.js"),i=require("../../cfg.js");if(!Array){const y=e.resolveComponent("uni-icons"),r=e.resolveComponent("no-more"),o=e.resolveComponent("empty");(y+r+o)()}const S=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",j=()=>"../../components/no-more/no-more.js",C=()=>"../../components/empty/empty.js";Math||(S+P+O+j+C)();const P=()=>"../../components/goods_unit/goods_unit.js",O=()=>"../../components/post_unit/post_unit.js",$=e.defineComponent({__name:"search",setup(y){const r=e.ref(""),o=e.ref(),u=e.ref(""),_=e.ref(!1),f=e.ref(!1),m=e.ref(0),v=e.ref([]),g=e.ref(!0);e.onLoad(a=>{r.value=a.type,p("r",null,0)}),e.onReachBottom(()=>{d(u.value,!1,!1)});function p(a,n,t){if(console.log(t),a==="r")o.value=JSON.parse(e.index.getStorageSync("history"));else{if(a==="w"){if(n==="")return;console.log(o.value.includes(n)),o.value.includes(n)&&o.value.filter(c=>c!==n),console.log(o.value),o.value.push(n),console.log(o.value);let s=o.value[0];const l=o.value.indexOf(n);o.value[0]=n,o.value[l]=s,console.log(o.value)}else a==="d"?o.value=o.value.splice(t,1):a==="c"&&(o.value=[]);console.log("setStorage"),e.index.setStorageSync("history",JSON.stringify(o.value))}console.log(o.value)}function h(){_.value=u.value.length>0}function d(a,n,t){const s=n?a:u.value,l=2;t&&(m.value=0),p("w",a,0),e.index.request({url:i.cfg.server+":"+i.cfg.port+i.cfg.api.prefix+i.cfg.api.user.prefix+i.cfg.api.user.search,method:"POST",data:{search_form:{keyword:s,type:r.value,start_at:m.value,amount:l}},success(c){console.log(c),c.statusCode===200&&(g.value=c.data.data.length===l,m.value=c.data.next_index,v.value=c.data.data,f.value=!0,console.log(v.value))}})}function x(){u.value="",_.value=!1}return(a,n)=>e.e({a:e.o(t=>d(u.value,!1,!0)),b:e.o(x),c:_.value,d:e.p({type:"clear",size:"4vh"}),e:e.o([t=>u.value=t.detail.value,h]),f:u.value,g:e.p({type:"search",size:"4vh"}),h:e.o(t=>f.value=!1),i:!f.value},f.value?e.e({m:v.value.length!==0},v.value.length!==0?e.e({n:e.f(v.value,(t,s,l)=>r.value==="goods"?{a:"6a7a151c-3-"+l,b:e.p({data:t})}:{c:"6a7a151c-4-"+l,d:e.p({data:t})}),o:r.value==="goods",p:!g.value},g.value?{}:{}):{}):{j:e.o(t=>p("c",null,0)),k:e.f(o.value,(t,s,l)=>({a:e.t(t),b:e.o(c=>d(t,!0,!0),s),c:e.o(c=>p("d",t,s),s),d:"6a7a151c-2-"+l,e:s})),l:e.p({type:"close"})})}}),b=e._export_sfc($,[["__file","F:/HBuilderProjects/FreeMarket/pages/search/search.vue"]]);wx.createPage(b);
