"use strict";const e=require("../../common/vendor.js"),i=require("../../cfg.js");if(!Array){const t=e.resolveComponent("uni-icons"),o=e.resolveComponent("uni-file-picker"),c=e.resolveComponent("uni-popup");(t+o+c)()}const _=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",v=()=>"../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js",x=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||(_+v+y+x)();const y=()=>"../../components/price_keypad/price_keypad.js",h=e.defineComponent({__name:"new_goods",setup(t){const o=e.ref({goods_id:"",owner:getApp().globalData.login.userid,goods_name:"",price:0,desc:"",status:"",imgs:[],post_date:"",isDel:!1}),c=e.ref(""),n=e.ref([]),u=e.ref(null);e.onLoad(s=>{c.value=s.operation,c.value==="modify"&&e.index.request({url:i.cfg.server+":"+i.cfg.port+i.cfg.api.prefix+i.cfg.api.goods.prefix+i.cfg.api.goods.goods_info,method:"POST",data:{goods_id:s.goods_id,isEdit:!0},success(a){if(console.log(a),a.statusCode===200){o.value=a.data.data,n.value=JSON.parse(JSON.stringify(a.data.data.imgs));for(let l in n.value)n.value[l].url=i.cfg.server+":"+i.cfg.port+"/"+n.value[l].url;console.log(n.value),console.log(o.value)}}})});function p(){u.value.open()}function r(s){o.value.price=1*s,u.value.close()}function d(s){console.log("upload",s),console.log(o.value.imgs),e.index.uploadFile({url:i.cfg.server+":"+i.cfg.port+i.cfg.api.prefix+i.cfg.api.files.prefix+i.cfg.api.files.upload_file,filePath:s.tempFilePaths[0],name:"file",success(a){if(console.log(a),a.statusCode===200){const l=JSON.parse(a.data)[0].path.split("\\"),m="files\\\\".concat(l[1]);o.value.imgs.push({name:JSON.parse(a.data)[0].filename,url:m,extname:s.tempFiles[0].extname}),console.log(o.value.imgs)}}})}function g(s){o.value.imgs=o.value.imgs.filter(a=>a.name!==s.tempFile.name),n.value=n.value.filter(a=>a.name!==s.tempFile.name),console.log("imgList:",n.value),console.log(o.value.imgs)}function f(){console.log(o.value),o.value.imgs.length===0&&o.value.imgs.push(i.cfg.empty_image),c.value==="new"?(console.log("new"),e.index.request({url:i.cfg.server+":"+i.cfg.port+i.cfg.api.prefix+i.cfg.api.goods.prefix+i.cfg.api.goods.add_goods,method:"POST",data:{new_goods:{owner:o.value.owner,goods_name:o.value.goods_name,desc:o.value.desc,price:o.value.price,status:o.value.status,imgs:o.value.imgs}},success(s){console.log(s),s.statusCode===200&&(e.index.switchTab({url:"/pages/index/index"}),e.index.showToast({icon:"success",title:"商品添加成功"}))}})):c.value==="modify"&&(console.log("modify"),e.index.request({url:i.cfg.server+":"+i.cfg.port+i.cfg.api.prefix+i.cfg.api.goods.prefix+i.cfg.api.goods.modify_goods,method:"POST",data:{modify_form:o.value,userid:getApp().globalData.login.userid},success(s){console.log(s),e.index.switchTab({url:"/pages/index/index"}),s.statusCode===200&&e.index.showToast({icon:"success",title:"商品修改成功"})}}))}return(s,a)=>({a:o.value.goods_name,b:e.o(l=>o.value.goods_name=l.detail.value),c:e.t(o.value.price),d:e.p({type:"right"}),e:e.o(p),f:o.value.status,g:e.o(l=>o.value.status=l.detail.value),h:o.value.desc,i:e.o(l=>o.value.desc=l.detail.value),j:e.t(c.value==="new"?"添加":"修改"),k:e.o(f),l:e.o(d),m:e.o(g),n:e.o(l=>n.value=l),o:e.p({fileMediatype:"image",limit:"9",title:"商品图片",modelValue:n.value}),p:e.o(r),q:e.p({price:o.value.price}),r:e.sr(u,"cd83e888-2",{k:"pricePopup"}),s:e.p({type:"bottom"})})}}),w=e._export_sfc(h,[["__scopeId","data-v-cd83e888"],["__file","F:/HBuilderProjects/FreeMarket/pages/new_goods/new_goods.vue"]]);wx.createPage(w);
